---
import Button from '../common/Button.astro';
---

<div data-aos="fade-up">
  <h2 class="text-xl font-bold text-gray-900 mb-4 flex items-center gap-2">
    <span class="text-2xl">✉️</span> Kirim Pesan
  </h2>
  <div class="bg-white rounded-2xl p-6 md:p-8 shadow-lg">
    <p class="text-gray-600 mb-6">
      Sampaikan pertanyaan, saran, kritik, atau aspirasi Anda. Pesan akan
      diteruskan ke perangkat dusun.
    </p>

    <form
      id="contact-form"
      action="https://docs.google.com/forms/d/e/{FORM_ID}/formResponse"
      method="POST"
      target="_blank"
      class="space-y-5"
    >
      <div>
        <label
          for="nama"
          class="block text-sm font-semibold text-gray-700 mb-2"
        >
          Nama Lengkap <span class="text-red-500">*</span>
        </label>
        <input
          type="text"
          id="nama"
          name="entry.XXXXX"
          required
          class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-primary/20 focus:border-primary outline-none transition"
          placeholder="Masukkan nama Anda"
        />
      </div>

      <div>
        <label
          for="kontak"
          class="block text-sm font-semibold text-gray-700 mb-2"
        >
          No. WhatsApp / Email <span class="text-red-500">*</span>
        </label>
        <input
          type="text"
          id="kontak"
          name="entry.XXXXX"
          required
          class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-primary/20 focus:border-primary outline-none transition"
          placeholder="08xxxxxxxxxx atau email@example.com"
        />
      </div>

      <div>
        <label
          for="jenis"
          class="block text-sm font-semibold text-gray-700 mb-2"
        >
          Jenis Pesan <span class="text-red-500">*</span>
        </label>
        <select
          id="jenis"
          name="entry.XXXXX"
          required
          class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-primary/20 focus:border-primary outline-none transition"
        >
          <option value="">Pilih jenis pesan</option>
          <option value="pertanyaan">Pertanyaan</option>
          <option value="saran">Saran</option>
          <option value="kritik">Kritik</option>
          <option value="kerjasama">Kerjasama</option>
          <option value="lainnya">Lainnya</option>
        </select>
      </div>

      <div>
        <label
          for="pesan"
          class="block text-sm font-semibold text-gray-700 mb-2"
        >
          Pesan <span class="text-red-500">*</span>
        </label>
        <textarea
          id="pesan"
          name="entry.XXXXX"
          rows="4"
          required
          class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-primary/20 focus:border-primary outline-none transition resize-none"
          placeholder="Tulis pesan Anda di sini..."
        >
        </textarea>
      </div>

      <Button type="submit" class="w-full"> Kirim Pesan → </Button>
    </form>

    <p class="text-xs text-gray-500 mt-4 text-center">
      Form ini akan membuka tab baru ke Google Forms.
    </p>
  </div>
</div>

<script>
  let formHandler: (() => void) | null = null;
  let formElement: HTMLElement | null = null;

  document.addEventListener('astro:page-load', () => {
    formElement = document.getElementById('contact-form');
    if (!formElement) return;

    formHandler = () => {
      setTimeout(() => {
        if (window.toast) {
          window.toast.show({
            message: 'Pesan Anda sedang dikirim. Terima kasih!',
            type: 'success',
            duration: 5000,
          });
        }
      }, 100);
    };

    formElement.addEventListener('submit', formHandler);
  });

  document.addEventListener('astro:before-swap', () => {
    if (formElement && formHandler) {
      formElement.removeEventListener('submit', formHandler);
      formHandler = null;
      formElement = null;
    }
  });
</script>
