---
import { LightGallery } from 'astro-lightgallery';
import { siteConfig } from '../../data/siteConfig';
import { uiStrings } from '../../data/uiStrings';

interface VideoItem {
  url: string;
  title: string;
}

interface Props {
  videos: VideoItem[];
  kode: string;
}

const { videos, kode } = Astro.props;

const applyTemplate = (
  template: string,
  vars: Record<string, string | number>
) => template.replace(/\{(\w+)\}/g, (_, key) => String(vars[key] ?? ''));

const subtitle = uiStrings.kkn.videos.subtitleTemplate
  ? applyTemplate(uiStrings.kkn.videos.subtitleTemplate, {
      kode,
      siteName: siteConfig.name,
    })
  : '';

function getYouTubeId(url: string): string | null {
  const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
  const match = url.match(regExp);
  return match && match[2].length === 11 ? match[2] : null;
}

function getYouTubeThumbnail(url: string): string {
  const videoId = getYouTubeId(url);
  return videoId
    ? `https://img.youtube.com/vi/${videoId}/maxresdefault.jpg`
    : '';
}
---

{
  videos.length > 0 && (
    <section
      id="video"
      class="py-12 lg:py-16 bg-gradient-to-br from-gray-50 to-white scroll-mt-16"
    >
      <div class="max-w-screen-2xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center mb-8" data-aos="fade-up">
          <h2 class="text-3xl md:text-4xl font-extrabold text-gray-900 mb-3">
            {uiStrings.kkn.videos.titlePrefix}{' '}
            <span class="gradient-text">KKN {kode}</span>
          </h2>
          <p class="text-gray-600 max-w-2xl mx-auto">
            {subtitle}
          </p>
          <p class="text-sm text-gray-500 mt-2">
            <span class="font-medium">{videos.length}</span>{' '}
            {uiStrings.common.video.toLowerCase()}
          </p>
        </div>

        <LightGallery
          options={{}}
          addPlugins={['video']}
          class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"
          id="kkn-video-gallery"
        >
          {videos.map((video, idx) => {
            const thumbUrl = getYouTubeThumbnail(video.url);

            return (
              <a
                href={video.url}
                data-sub-html={`<h4>${video.title}</h4>`}
                class="group relative aspect-video overflow-hidden rounded-2xl bg-gray-900 shadow-lg hover:shadow-xl transition-all cursor-pointer"
                data-aos="fade-up"
                data-aos-delay={idx * 100}
              >
                {thumbUrl ? (
                  <img
                    src={thumbUrl}
                    alt={video.title}
                    class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"
                    loading="lazy"
                  />
                ) : (
                  <div class="w-full h-full bg-gray-800 flex items-center justify-center">
                    <span class="text-4xl">ðŸŽ¬</span>
                  </div>
                )}

                <div class="absolute inset-0 flex items-center justify-center">
                  <div class="w-16 h-16 bg-red-600 rounded-full flex items-center justify-center shadow-lg group-hover:scale-110 transition-transform">
                    <svg
                      class="w-7 h-7 text-white ml-1"
                      fill="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path d="M8 5v14l11-7z" />
                    </svg>
                  </div>
                </div>

                <div class="absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-black/80 to-transparent">
                  <p class="text-white font-semibold line-clamp-2">
                    {video.title}
                  </p>
                </div>
              </a>
            );
          })}
        </LightGallery>
      </div>
    </section>
  )
}
