---
import { getEntry } from 'astro:content';
import SectionTitle from '../common/SectionTitle.astro';

const data = await getEntry('profil', 'pemerintahan');
const pemerintahan = data?.data?.pemerintahan || [];

const kepalaDusun = pemerintahan.find((p) => p.jabatan === 'Kepala Dusun');
const ketuaRW = pemerintahan.find((p) => p.jabatan === 'Ketua RW');
const ketuaRT = pemerintahan.filter((p) => p.jabatan.startsWith('Ketua RT'));
---

<div class="mb-12">
  <SectionTitle title="Struktur Pemerintahan Dusun" />

  <!-- Kepala Dusun - Featured -->
  {
    kepalaDusun && (
      <div class="flex justify-center mb-8" data-aos="zoom-in">
        <div class="bg-gradient-to-br from-primary to-primary-dark rounded-2xl p-6 shadow-xl text-center max-w-sm w-full">
          <div class="w-24 h-24 bg-white/20 rounded-full flex items-center justify-center mx-auto mb-4 ring-4 ring-white/30">
            {kepalaDusun.foto ? (
              <img
                src={kepalaDusun.foto}
                alt={kepalaDusun.nama}
                class="w-full h-full rounded-full object-cover"
              />
            ) : (
              <svg
                class="w-12 h-12 text-white/80"
                fill="currentColor"
                viewBox="0 0 24 24"
              >
                <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" />
              </svg>
            )}
          </div>
          <h3 class="text-xl font-bold text-white mb-1">{kepalaDusun.nama}</h3>
          <p class="text-white/80 font-medium">{kepalaDusun.jabatan}</p>
        </div>
      </div>
    )
  }

  <!-- Ketua RW -->
  {
    ketuaRW && (
      <div class="flex justify-center mb-8" data-aos="fade-up">
        <div class="bg-white rounded-2xl p-5 shadow-lg text-center max-w-xs w-full hover:shadow-xl transition-shadow">
          <div class="w-20 h-20 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-4">
            {ketuaRW.foto ? (
              <img
                src={ketuaRW.foto}
                alt={ketuaRW.nama}
                class="w-full h-full rounded-full object-cover"
              />
            ) : (
              <svg
                class="w-10 h-10 text-primary/60"
                fill="currentColor"
                viewBox="0 0 24 24"
              >
                <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" />
              </svg>
            )}
          </div>
          <h3 class="text-lg font-bold text-gray-900 mb-1">{ketuaRW.nama}</h3>
          <p class="text-gray-500 text-sm font-medium">{ketuaRW.jabatan}</p>
        </div>
      </div>
    )
  }

  <!-- Ketua RT Grid -->
  {
    ketuaRT.length > 0 && (
      <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 max-w-3xl mx-auto">
        {ketuaRT.map((rt, index) => (
          <div
            class="bg-white rounded-2xl p-5 shadow-lg text-center hover:shadow-xl transition-shadow"
            data-aos="fade-up"
            data-aos-delay={Math.min(index * 100, 300)}
          >
            <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-3">
              {rt.foto ? (
                <img
                  src={rt.foto}
                  alt={rt.nama}
                  class="w-full h-full rounded-full object-cover"
                />
              ) : (
                <svg
                  class="w-8 h-8 text-gray-400"
                  fill="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" />
                </svg>
              )}
            </div>
            <h3 class="font-bold text-gray-900 mb-1">{rt.nama}</h3>
            <p class="text-gray-500 text-sm">{rt.jabatan}</p>
          </div>
        ))}
      </div>
    )
  }
</div>
