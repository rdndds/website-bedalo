---
import { mainNavItems } from '../../data/navigation';

const currentPath = Astro.url.pathname;
---

<header
  class="bg-white shadow-sm fixed top-0 left-0 right-0 z-40"
  role="banner"
>
  <nav
    class="max-w-screen-2xl mx-auto px-4 sm:px-6 lg:px-8"
    aria-label="Menu utama"
  >
    <div class="flex justify-between h-16">
      <div class="flex items-center">
        <a href="/" class="flex items-center gap-2">
          <span class="font-bold text-xl text-primary sm:block">
            Dusun Bedalo
          </span>
        </a>
      </div>

      <div class="hidden lg:flex items-center gap-1">
        {
          mainNavItems.map((item) => (
            <a
              href={item.href}
              class:list={[
                'px-3 py-2 rounded-lg text-sm font-medium transition-colors',
                currentPath === item.href ||
                (item.href !== '/' && currentPath.startsWith(item.href))
                  ? 'bg-primary text-white'
                  : 'text-gray-700 hover:bg-gray-200',
              ]}
            >
              {item.label}
            </a>
          ))
        }
      </div>

      <div class="lg:hidden flex items-center">
        <button
          id="mobile-menu-btn"
          type="button"
          class="p-2 rounded-lg text-gray-700 hover:bg-gray-200 transition-colors"
          aria-label="Toggle menu"
        >
          <svg
            id="icon-hamburger"
            class="w-6 h-6"
            viewBox="0 0 24 24"
            fill="currentColor"
          >
            <rect x="3" y="5" width="18" height="2.5" rx="1.25"></rect>
            <rect x="3" y="11" width="12" height="2.5" rx="1.25"></rect>
            <rect x="3" y="17" width="18" height="2.5" rx="1.25"></rect>
          </svg>
          <svg
            id="icon-close"
            class="w-6 h-6 hidden"
            viewBox="0 0 24 24"
            fill="currentColor"
          >
            <path
              d="M18.3 5.71a1 1 0 00-1.42 0L12 10.59 7.12 5.71a1 1 0 00-1.42 1.42L10.59 12l-4.89 4.88a1 1 0 101.42 1.42L12 13.41l4.88 4.89a1 1 0 001.42-1.42L13.41 12l4.89-4.88a1 1 0 000-1.41z"
            >
            </path>
          </svg>
        </button>
      </div>
    </div>
  </nav>
</header>

<!-- Full screen mobile menu overlay -->
<div id="mobile-menu" class="fixed inset-0 z-50 hidden">
  <!-- Backdrop -->
  <div
    id="menu-backdrop"
    class="absolute inset-0 bg-black/50 transition-opacity"
  >
  </div>

  <!-- Menu panel -->
  <div
    id="menu-panel"
    class="absolute right-0 top-0 h-full w-72 bg-white shadow-2xl transform transition-transform translate-x-full"
  >
    <!-- Header -->
    <div class="flex items-center justify-end h-16 px-4">
      <button
        id="menu-close-btn"
        class="p-2 rounded-lg text-gray-500 hover:bg-gray-200 transition-colors"
      >
        <svg class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor">
          <path
            d="M18.3 5.71a1 1 0 00-1.42 0L12 10.59 7.12 5.71a1 1 0 00-1.42 1.42L10.59 12l-4.89 4.88a1 1 0 101.42 1.42L12 13.41l4.88 4.89a1 1 0 001.42-1.42L13.41 12l4.89-4.88a1 1 0 000-1.41z"
          >
          </path>
        </svg>
      </button>
    </div>

    <!-- Nav items -->
    <nav class="p-4">
      <div class="flex flex-col gap-1">
        {
          mainNavItems.map((item) => (
            <a
              href={item.href}
              class:list={[
                'menu-link px-4 py-3 rounded-xl text-base font-medium transition-all',
                currentPath === item.href ||
                (item.href !== '/' && currentPath.startsWith(item.href))
                  ? 'bg-primary text-white'
                  : 'text-gray-700 hover:bg-gray-200',
              ]}
            >
              {item.label}
            </a>
          ))
        }
      </div>
    </nav>
  </div>
</div>

<script>
  let cleanupFns: (() => void)[] = [];

  document.addEventListener('astro:page-load', () => {
    const menuBtn = document.getElementById('mobile-menu-btn');
    const menuCloseBtn = document.getElementById('menu-close-btn');
    const menu = document.getElementById('mobile-menu');
    const backdrop = document.getElementById('menu-backdrop');
    const panel = document.getElementById('menu-panel');
    const iconHamburger = document.getElementById('icon-hamburger');
    const iconClose = document.getElementById('icon-close');
    const menuLinks = document.querySelectorAll('.menu-link');

    function openMenu() {
      menu?.classList.remove('hidden');
      document.body.style.overflow = 'hidden';
      setTimeout(() => {
        panel?.classList.remove('translate-x-full');
      }, 10);
      iconHamburger?.classList.add('hidden');
      iconClose?.classList.remove('hidden');
    }

    function closeMenu() {
      panel?.classList.add('translate-x-full');
      iconHamburger?.classList.remove('hidden');
      iconClose?.classList.add('hidden');
      setTimeout(() => {
        menu?.classList.add('hidden');
        document.body.style.overflow = '';
      }, 300);
    }

    if (menuBtn) {
      menuBtn.addEventListener('click', openMenu);
      cleanupFns.push(() => menuBtn.removeEventListener('click', openMenu));
    }
    if (menuCloseBtn) {
      menuCloseBtn.addEventListener('click', closeMenu);
      cleanupFns.push(() =>
        menuCloseBtn.removeEventListener('click', closeMenu)
      );
    }
    if (backdrop) {
      backdrop.addEventListener('click', closeMenu);
      cleanupFns.push(() => backdrop.removeEventListener('click', closeMenu));
    }
    menuLinks.forEach((link) => {
      link.addEventListener('click', closeMenu);
      cleanupFns.push(() => link.removeEventListener('click', closeMenu));
    });
  });

  document.addEventListener('astro:before-swap', () => {
    cleanupFns.forEach((fn) => fn());
    cleanupFns = [];
  });
</script>
